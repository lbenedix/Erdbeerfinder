<!DOCTYPE htl>
<meta charset="utf-8">
<link href="manifest.json" rel="manifest"/>
<link href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üçì</text></svg>"
      rel="icon">

<link href="https://unpkg.com/leaflet@latest/dist/leaflet.css" rel="stylesheet"/>
<style>
    html, body, #map {
        margin: 0;
        height: 100%;
        width: 100%;
    }
</style>
<meta content="initial-scale=1.0, user-scalable=no" name="viewport"/>
<title>Erdbeerfinder</title>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@latest/dist/leaflet.js"></script>

<link href="https://unpkg.com/leaflet.locatecontrol@latest/dist/L.Control.Locate.min.css" rel="stylesheet"/>
<script src="https://unpkg.com/leaflet.locatecontrol@latest/dist/L.Control.Locate.min.js"></script>

<script>
    var map = L.map('map');
    lc = L.control
        .locate({
            strings: {
                title: "Show me where I am, yo!"
            }
        })
        .addTo(map);
    var layer;

    // Define the custom strawberry icon
    var strawberryIcon = L.icon({
        iconUrl: 'strawberry.png', // Replace with your actual path or URL
        iconSize: [48, 48],      // increased size
        iconAnchor: [24, 48],    // center bottom
        popupAnchor: [0, -48]    // above the icon
    });

    var strawberryIconBW = L.icon({
        iconUrl: 'strawberry_bw.png', // Replace with your actual path or URL
        iconSize: [32, 32], // adjust size as needed
        iconAnchor: [16, 32], // point of the icon which will correspond to marker's location
        popupAnchor: [0, -32] // point from which the popup should open relative to the iconAnchor
    });


    // Use pointToLayer to set the icon for each feature
    function pointToLayer(feature, latlng) {
        var icon = feature.properties && feature.properties.isOpened ? strawberryIcon : strawberryIconBW;
        return L.marker(latlng, {icon: icon});
    }

    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    function onEachFeature(feature, layer) {
        if (feature.properties)
            layer.bindPopup(Object.entries(feature.properties).map((prop) => prop.join(': ')).join('<br>'));
    }


    function updateGeoJson() {
        if (layer) {
            map.removeLayer(layer);
            layer = undefined;
        }
        fetch("/karls.geo.json", {cors: true})
            .then((resp) => resp.json())
            .then((json) => {
                layer = L.geoJson(json, {onEachFeature, pointToLayer}).addTo(map);
                map.fitBounds(layer.getBounds());
            })
            .catch(() => alert('Error loading or parsing GeoJSON'))
    }

    updateGeoJson();
</script>
